# ðŸ—ï¸ Architecture Technique MayanConnect

## Vue d'Ensemble

MayanConnect est une architecture micro-services 100% conteneurisÃ©e qui sÃ©pare clairement les responsabilitÃ©s entre authentification, gestion documentaire et intelligence artificielle.

---

## Diagramme d'Architecture DÃ©taillÃ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              UTILISATEURS                                       â”‚
â”‚                                                                                 â”‚
â”‚  ðŸ‘¤ USER (AccÃ¨s temporaire)  ðŸ‘¤ CONSULTANT (AccÃ¨s permanent)  ðŸ‘¤ ADMIN (ContrÃ´le total) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ HTTPS (Port 80)
                                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           FRONTEND (React + TypeScript)                          â”‚
â”‚                               Nginx:alpine - Port 80                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ â”‚  Dashboard  â”‚  â”‚  Documents  â”‚  â”‚    Admin    â”‚  â”‚   Viewer    â”‚            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚   â€¢ Statistiques   â€¢ Upload docs    â€¢ Users mgmt    â€¢ AI Analysis              â”‚
â”‚   â€¢ AccÃ¨s status   â€¢ Search OCR     â€¢ Roles mgmt    â€¢ PDF Viewer               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                              â”‚
                 â”‚ JWT Bearer Token             â”‚ Direct API Calls
                 â†“                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     BACKEND CUSTOM (Node.js)        â”‚  â”‚       MAYAN EDMS (Django)            â”‚
â”‚      Express + TypeScript           â”‚  â”‚     mayanedms/mayanedms:5.0          â”‚
â”‚         Port: 3000                  â”‚  â”‚          Port: 8000                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  ðŸ” Auth Controller             â”‚ â”‚  â”‚ â”‚  ðŸ“„ Document Management          â”‚ â”‚
â”‚ â”‚  â€¢ JWT generation               â”‚ â”‚  â”‚ â”‚  â€¢ Upload/Download              â”‚ â”‚
â”‚ â”‚  â€¢ Password hashing (bcrypt)    â”‚ â”‚  â”‚ â”‚  â€¢ Metadata management          â”‚ â”‚
â”‚ â”‚  â€¢ Session management           â”‚ â”‚  â”‚ â”‚  â€¢ Version control              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  ðŸ‘¥ User Management             â”‚ â”‚  â”‚ â”‚  ðŸ” OCR Engine (Tesseract)       â”‚ â”‚
â”‚ â”‚  â€¢ Registration                 â”‚ â”‚  â”‚ â”‚  â€¢ Automatic text extraction    â”‚ â”‚
â”‚ â”‚  â€¢ Profile CRUD                 â”‚ â”‚  â”‚ â”‚  â€¢ Multi-language support       â”‚ â”‚
â”‚ â”‚  â€¢ Role assignment (3 roles)    â”‚ â”‚  â”‚ â”‚  â€¢ Full-text indexing           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  â° Temporary Access Manager    â”‚ â”‚  â”‚ â”‚  ðŸ”Ž Search Engine                â”‚ â”‚
â”‚ â”‚  â€¢ Time window definition       â”‚ â”‚  â”‚ â”‚  â€¢ Full-text search             â”‚ â”‚
â”‚ â”‚  â€¢ Access validation middleware â”‚ â”‚  â”‚ â”‚  â€¢ Metadata filtering           â”‚ â”‚
â”‚ â”‚  â€¢ Status tracking (3 states)   â”‚ â”‚  â”‚ â”‚  â€¢ Advanced queries             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  ðŸ“§ Email Service (Resend)      â”‚ â”‚  â”‚ â”‚  ðŸ“ File Storage                 â”‚ â”‚
â”‚ â”‚  â€¢ Welcome emails               â”‚ â”‚  â”‚ â”‚  â€¢ Binary files (PDF, images)   â”‚ â”‚
â”‚ â”‚  â€¢ Password reset               â”‚ â”‚  â”‚ â”‚  â€¢ Thumbnails generation        â”‚ â”‚
â”‚ â”‚  â€¢ French templates             â”‚ â”‚  â”‚ â”‚  â€¢ Document versioning          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  ðŸ¤– AI Proxy Service            â”‚ â”‚  â”‚ â”‚  ðŸ”„ Task Queue (Celery)          â”‚ â”‚
â”‚ â”‚  â€¢ Document analysis requests   â”‚ â”‚  â”‚ â”‚  â€¢ OCR processing jobs          â”‚ â”‚
â”‚ â”‚  â€¢ Response formatting          â”‚ â”‚  â”‚ â”‚  â€¢ Background tasks             â”‚ â”‚
â”‚ â”‚  â€¢ Error handling               â”‚ â”‚  â”‚ â”‚  â€¢ Async operations             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                                          â”‚
               â”‚ Prisma ORM                               â”‚ Django ORM
               â†“                                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL (Backend)        â”‚              â”‚   PostgreSQL (Mayan)         â”‚
â”‚   postgres:15-alpine          â”‚              â”‚   postgres:15-alpine         â”‚
â”‚      Port: 5433               â”‚              â”‚      Port: 5432              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  Users Table             â”‚ â”‚              â”‚ â”‚  Documents Table         â”‚ â”‚
â”‚ â”‚  â€¢ id, email, password   â”‚ â”‚              â”‚ â”‚  â€¢ id, uuid, label       â”‚ â”‚
â”‚ â”‚  â€¢ role, isActive        â”‚ â”‚              â”‚ â”‚  â€¢ file_path, size       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  TemporaryAccess Table   â”‚ â”‚              â”‚ â”‚  DocumentTypes Table     â”‚ â”‚
â”‚ â”‚  â€¢ userId, startDate     â”‚ â”‚              â”‚ â”‚  â€¢ id, label             â”‚ â”‚
â”‚ â”‚  â€¢ endDate, isActive     â”‚ â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚ â”‚  OCRContent Table        â”‚ â”‚
â”‚ â”‚  PasswordResetToken      â”‚ â”‚              â”‚ â”‚  â€¢ document_id, text     â”‚ â”‚
â”‚ â”‚  â€¢ token, userId         â”‚ â”‚              â”‚ â”‚  â€¢ page_number           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                               â”‚
                                                               â†“
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚      Redis (Cache)           â”‚
                                              â”‚    redis:7-alpine            â”‚
                                              â”‚      Port: 6379              â”‚
                                              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                                              â”‚ â”‚  â€¢ Session cache         â”‚ â”‚
                                              â”‚ â”‚  â€¢ Task queue broker     â”‚ â”‚
                                              â”‚ â”‚  â€¢ Search results cache  â”‚ â”‚
                                              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚    OLLAMA AI          â”‚
               â”‚  ollama/ollama:latest â”‚
               â”‚    Port: 11434        â”‚
               â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
               â”‚ â”‚  Llama 3.2 3B     â”‚ â”‚
               â”‚ â”‚  â€¢ Summarization  â”‚ â”‚
               â”‚ â”‚  â€¢ Keyword extractâ”‚ â”‚
               â”‚ â”‚  â€¢ Privacy-first  â”‚ â”‚
               â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†‘
                        â”‚ REST API calls
                        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    Backend AI Service       â”‚
         â”‚  (POST /api/ai/analyze)     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flux de DonnÃ©es DÃ©taillÃ©s

### 1ï¸âƒ£ Flux d'Authentification

```
â”Œâ”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚                           â”‚ Backend â”‚                    â”‚  PostgreSQL  â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜                           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                                   â”‚                                â”‚
    â”‚ POST /api/auth/login              â”‚                                â”‚
    â”‚  { email, password }              â”‚                                â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                                â”‚
    â”‚                                   â”‚ SELECT * FROM Users            â”‚
    â”‚                                   â”‚  WHERE email = ?               â”‚
    â”‚                                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                                   â”‚                                â”‚
    â”‚                                   â”‚ <â”€â”€ User data                  â”‚
    â”‚                                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                   â”‚                                â”‚
    â”‚                                   â”‚ bcrypt.compare(password)       â”‚
    â”‚                                   â”‚                                â”‚
    â”‚                                   â”‚ jwt.sign({ userId, role })     â”‚
    â”‚                                   â”‚                                â”‚
    â”‚ <â”€â”€ { token, user }               â”‚                                â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                â”‚
    â”‚                                   â”‚                                â”‚
```

### 2ï¸âƒ£ Flux de Gestion d'AccÃ¨s Temporaire

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ADMIN â”‚              â”‚ Backend â”‚              â”‚  PostgreSQL  â”‚              â”‚   USER   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚                       â”‚                          â”‚                            â”‚
    â”‚ POST /api/access      â”‚                          â”‚                            â”‚
    â”‚ {userId, startDate,   â”‚                          â”‚                            â”‚
    â”‚  endDate}             â”‚                          â”‚                            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚                            â”‚
    â”‚                       â”‚ INSERT INTO              â”‚                            â”‚
    â”‚                       â”‚  TemporaryAccess         â”‚                            â”‚
    â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                            â”‚
    â”‚                       â”‚                          â”‚                            â”‚
    â”‚ <â”€â”€ Access created    â”‚                          â”‚                            â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚                            â”‚
    â”‚                       â”‚                          â”‚                            â”‚
    â”‚                       â”‚                          â”‚  GET /api/documents        â”‚
    â”‚                       â”‚                          â”‚  (Bearer token)            â”‚
    â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                       â”‚                          â”‚                            â”‚
    â”‚                       â”‚ Middleware:              â”‚                            â”‚
    â”‚                       â”‚  checkTemporaryAccess()  â”‚                            â”‚
    â”‚                       â”‚                          â”‚                            â”‚
    â”‚                       â”‚ SELECT * FROM            â”‚                            â”‚
    â”‚                       â”‚  TemporaryAccess         â”‚                            â”‚
    â”‚                       â”‚  WHERE userId=? AND      â”‚                            â”‚
    â”‚                       â”‚  NOW() BETWEEN           â”‚                            â”‚
    â”‚                       â”‚  startDate AND endDate   â”‚                            â”‚
    â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                            â”‚
    â”‚                       â”‚                          â”‚                            â”‚
    â”‚                       â”‚ <â”€â”€ Access found         â”‚                            â”‚
    â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
    â”‚                       â”‚                          â”‚                            â”‚
    â”‚                       â”‚ âœ… Access granted        â”‚                            â”‚
    â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                       â”‚                          â”‚                            â”‚
```

### 3ï¸âƒ£ Flux Upload & OCR

```
â”Œâ”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚            â”‚ Frontendâ”‚            â”‚   Mayan  â”‚            â”‚   Redis  â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚                    â”‚                       â”‚                       â”‚
    â”‚ Select PDF file    â”‚                       â”‚                       â”‚
    â”‚ Click "Upload"     â”‚                       â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                       â”‚
    â”‚                    â”‚ POST /api/documents/  â”‚                       â”‚
    â”‚                    â”‚  upload (multipart)   â”‚                       â”‚
    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
    â”‚                    â”‚                       â”‚ Save file to disk     â”‚
    â”‚                    â”‚                       â”‚                       â”‚
    â”‚                    â”‚                       â”‚ INSERT INTO Documents â”‚
    â”‚                    â”‚                       â”‚                       â”‚
    â”‚                    â”‚                       â”‚ Queue OCR task        â”‚
    â”‚                    â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                    â”‚                       â”‚                       â”‚
    â”‚                    â”‚ <â”€â”€ Document created  â”‚                       â”‚
    â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚ <â”€â”€ Success + docIdâ”‚                       â”‚                       â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                       â”‚
    â”‚                    â”‚                       â”‚                       â”‚
    â”‚                    â”‚                       â”‚ <â”€â”€ Celery worker     â”‚
    â”‚                    â”‚                       â”‚     processes OCR     â”‚
    â”‚                    â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                    â”‚                       â”‚                       â”‚
    â”‚                    â”‚                       â”‚ Tesseract extracts    â”‚
    â”‚                    â”‚                       â”‚  text from PDF        â”‚
    â”‚                    â”‚                       â”‚                       â”‚
    â”‚                    â”‚                       â”‚ INSERT INTO           â”‚
    â”‚                    â”‚                       â”‚  OCRContent           â”‚
    â”‚                    â”‚                       â”‚                       â”‚
    â”‚ Poll OCR status    â”‚                       â”‚                       â”‚
    â”‚ GET /documents/    â”‚                       â”‚                       â”‚
    â”‚  :id/ocr-status    â”‚                       â”‚                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
    â”‚                    â”‚                       â”‚                       â”‚
    â”‚ <â”€â”€ {ready: true}  â”‚                       â”‚                       â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
    â”‚                    â”‚                       â”‚                       â”‚
```

### 4ï¸âƒ£ Flux Analyse IA

```
â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚         â”‚ Frontend â”‚         â”‚ Backend â”‚         â”‚   Mayan  â”‚         â”‚ Ollama â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚                  â”‚                   â”‚                    â”‚                   â”‚
    â”‚ View document    â”‚                   â”‚                    â”‚                   â”‚
    â”‚ Click "Analyser" â”‚                   â”‚                    â”‚                   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                    â”‚                   â”‚
    â”‚                  â”‚ POST /api/ai/     â”‚                    â”‚                   â”‚
    â”‚                  â”‚  analyze          â”‚                    â”‚                   â”‚
    â”‚                  â”‚  {documentId: 123}â”‚                    â”‚                   â”‚
    â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                   â”‚
    â”‚                  â”‚                   â”‚ GET /api/documents/â”‚                   â”‚
    â”‚                  â”‚                   â”‚  123/download      â”‚                   â”‚
    â”‚                  â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
    â”‚                  â”‚                   â”‚                    â”‚                   â”‚
    â”‚                  â”‚                   â”‚ <â”€â”€ PDF binary     â”‚                   â”‚
    â”‚                  â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
    â”‚                  â”‚                   â”‚                    â”‚                   â”‚
    â”‚                  â”‚                   â”‚ Extract text from  â”‚                   â”‚
    â”‚                  â”‚                   â”‚  PDF (PDF-Parse)   â”‚                   â”‚
    â”‚                  â”‚                   â”‚                    â”‚                   â”‚
    â”‚                  â”‚                   â”‚ Truncate to 4000   â”‚                   â”‚
    â”‚                  â”‚                   â”‚  characters        â”‚                   â”‚
    â”‚                  â”‚                   â”‚                    â”‚                   â”‚
    â”‚                  â”‚                   â”‚ POST /api/generate â”‚                   â”‚
    â”‚                  â”‚                   â”‚  {                 â”‚                   â”‚
    â”‚                  â”‚                   â”‚   model: "llama3.2"â”‚                   â”‚
    â”‚                  â”‚                   â”‚   prompt: "RÃ©sume.."                   â”‚
    â”‚                  â”‚                   â”‚  }                 â”‚                   â”‚
    â”‚                  â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                  â”‚                   â”‚                    â”‚                   â”‚
    â”‚                  â”‚                   â”‚                    â”‚    Llama 3.2 3B  â”‚
    â”‚                  â”‚                   â”‚                    â”‚    processes text â”‚
    â”‚                  â”‚                   â”‚                    â”‚    generates      â”‚
    â”‚                  â”‚                   â”‚                    â”‚    summary +      â”‚
    â”‚                  â”‚                   â”‚                    â”‚    keywords       â”‚
    â”‚                  â”‚                   â”‚                    â”‚                   â”‚
    â”‚                  â”‚                   â”‚ <â”€â”€ {              â”‚                   â”‚
    â”‚                  â”‚                   â”‚   response: "..."  â”‚                   â”‚
    â”‚                  â”‚                   â”‚ }                  â”‚                   â”‚
    â”‚                  â”‚                   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                  â”‚                   â”‚                    â”‚                   â”‚
    â”‚                  â”‚                   â”‚ Parse response     â”‚                   â”‚
    â”‚                  â”‚                   â”‚  extract summary & â”‚                   â”‚
    â”‚                  â”‚                   â”‚  keywords          â”‚                   â”‚
    â”‚                  â”‚                   â”‚                    â”‚                   â”‚
    â”‚                  â”‚ <â”€â”€ {             â”‚                    â”‚                   â”‚
    â”‚                  â”‚   documentId: 123,â”‚                    â”‚                   â”‚
    â”‚                  â”‚   summary: "...", â”‚                    â”‚                   â”‚
    â”‚                  â”‚   keywords: [...]  â”‚                   â”‚                   â”‚
    â”‚                  â”‚ }                 â”‚                    â”‚                   â”‚
    â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                   â”‚
    â”‚                  â”‚                   â”‚                    â”‚                   â”‚
    â”‚ Display analysis â”‚                   â”‚                    â”‚                   â”‚
    â”‚  ðŸ“ Summary       â”‚                   â”‚                    â”‚                   â”‚
    â”‚  ðŸ”‘ Keywords      â”‚                   â”‚                    â”‚                   â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚                    â”‚                   â”‚
    â”‚                  â”‚                   â”‚                    â”‚                   â”‚
```

---

## SÃ©paration des ResponsabilitÃ©s

### Backend Custom
**RÃ´le** : Authentification & ContrÃ´le d'accÃ¨s
- âœ… Gestion des utilisateurs
- âœ… JWT tokens
- âœ… Roles (USER, CONSULTANT, ADMIN)
- âœ… FenÃªtres d'accÃ¨s temporaire
- âœ… Proxy sÃ©curisÃ© vers Mayan
- âœ… Service email
- âœ… Service AI (orchestration)

### Mayan EDMS
**RÃ´le** : Gestion documentaire
- âœ… Upload/Download documents
- âœ… OCR (Tesseract)
- âœ… Recherche full-text
- âœ… MÃ©tadonnÃ©es
- âœ… Types de documents
- âœ… File storage

### Ollama AI
**RÃ´le** : Intelligence Artificielle
- âœ… RÃ©sumÃ©s de documents
- âœ… Extraction de mots-clÃ©s
- âœ… ModÃ¨le Llama 3.2 3B
- âœ… 100% local (privacy-first)

---

## SÃ©curitÃ© par Couches

### Couche 1 : Frontend
- CORS strict (only localhost)
- XSS protection via React
- No secrets in code

### Couche 2 : Backend
- JWT validation on every request
- Bcrypt password hashing (12 rounds)
- Helmet.js security headers
- Express rate limiting
- Input validation (express-validator)

### Couche 3 : Middleware
- `authenticate` : Valide le JWT
- `checkTemporaryAccess` : VÃ©rifie fenÃªtre d'accÃ¨s
- `requireAdmin` : VÃ©rifie rÃ´le ADMIN

### Couche 4 : Base de donnÃ©es
- PostgreSQL (no SQL injection via Prisma ORM)
- Passwords never stored in plain text
- Separate DBs for Backend & Mayan

### Couche 5 : Network
- Docker private network
- Services non exposÃ©s Ã  l'extÃ©rieur
- Only Frontend, Backend, Mayan on host network

---

## Performance & ScalabilitÃ©

### Optimisations Actuelles
- âœ… Redis cache pour Mayan (sessions, rÃ©sultats de recherche)
- âœ… Pagination sur liste documents (50 items/page)
- âœ… Lazy loading des images
- âœ… OCR en arriÃ¨re-plan (Celery workers)
- âœ… Compression Gzip sur Frontend (Nginx)

### PossibilitÃ©s de Scale-up
- Ajouter des workers Celery pour OCR
- Load balancer devant Backend (Nginx, Traefik)
- PostgreSQL replication (master-slave)
- Redis Cluster pour haute disponibilitÃ©
- CDN pour assets statiques
- Horizontal scaling avec Kubernetes

---

## Monitoring & ObservabilitÃ©

### Health Checks
- Backend: `GET /health`
- Mayan: `GET /api/`
- Ollama: `GET /api/tags`
- PostgreSQL: `pg_isready`

### Logs
- Docker logs centralisÃ©s : `docker-compose logs -f`
- Backend logs : console.log + Winston (configurable)
- Mayan logs : Django logging
- Nginx access logs

### MÃ©triques
- Docker stats : CPU, RAM, I/O
- Prometheus + Grafana (Ã  ajouter)

---

## RÃ©seau Docker

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Docker Network: mayanconnect_default          â”‚
â”‚                         (Bridge Mode)                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Frontend:80   â”‚   â”‚  Backend:3000  â”‚   â”‚  Mayan:8000 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â”‚                     â”‚                    â”‚        â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                              â”‚                               â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚     â†“              â†“                  â†“              â†“      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚Ollamaâ”‚    â”‚Postgres  â”‚    â”‚Postgres  â”‚    â”‚ Redis  â”‚   â”‚
â”‚  â”‚:11434â”‚    â”‚(Backend) â”‚    â”‚ (Mayan)  â”‚    â”‚ :6379  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜    â”‚  :5433   â”‚    â”‚  :5432   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                   Host Network
            (Exposed: 80, 3000, 8000)
```

---

## Volumes & Persistance

```
Volumes Docker:
â”œâ”€â”€ backend-db-data         â†’ PostgreSQL Backend (Users, Access)
â”œâ”€â”€ mayan-postgres-data     â†’ PostgreSQL Mayan (Documents metadata)
â”œâ”€â”€ mayan-data              â†’ Mayan files (PDFs, images, thumbnails)
â””â”€â”€ ollama-data             â†’ Ollama models (Llama 3.2 3B = ~2GB)
```

**Total espace disque** : ~15 GB
- Backend DB: ~100 MB
- Mayan DB: ~500 MB
- Mayan files: ~5 GB (dÃ©pend du nombre de documents)
- Ollama model: ~2 GB
- Docker images: ~7 GB

---

## Points Techniques Remarquables

### 1. Middleware `checkTemporaryAccess`
Logique intelligente selon les rÃ´les :
- **USER** : VÃ©rifie fenÃªtre d'accÃ¨s active
- **CONSULTANT** : Bypass automatique (accÃ¨s permanent)
- **ADMIN** : Bypass automatique (accÃ¨s total)

### 2. Service AI Intelligent
- GÃ¨re les timeouts (120s)
- Parse la rÃ©ponse Ollama
- Extrait rÃ©sumÃ© + mots-clÃ©s via regex
- GÃ¨re les erreurs gracieusement

### 3. OCR Asynchrone
- Documents traitÃ©s en arriÃ¨re-plan
- Polling frontend pour statut
- Workers Celery dÃ©diÃ©s

### 4. Email Templates Professionnels
- HTML responsive
- Design moderne avec gradients
- 100% en franÃ§ais
- Logo + footer

---

**Architecture validÃ©e pour Nuit de l'Informatique 2025** âœ…
